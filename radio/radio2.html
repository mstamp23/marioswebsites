<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Radio Live 2026 üéµ</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@600;800&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --accent:#e8a838; --bg:#0d0d0d;
    --card:rgba(255,255,255,0.04); --card-h:rgba(255,255,255,0.08);
    --border:rgba(255,255,255,0.07); --text:#f0ece3; --muted:#777;
    --glow:0 0 25px rgba(232,168,56,0.25);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'DM Sans', sans-serif; background:var(--bg); color:var(--text); min-height:100vh; overflow-x:hidden; }
  
  header { padding:40px 20px; text-align:center; position:relative; z-index:2; }
  h1 { font-family:'Syne', sans-serif; font-size:2.2rem; font-weight:800; color:var(--accent); margin-bottom:10px; }
  .search-container { max-width:500px; margin:10px auto; }
  input { width:100%; padding:14px 25px; border-radius:30px; border:1px solid var(--border); background:var(--card); color:#fff; outline:none; transition:0.3s; }
  input:focus { border-color:var(--accent); box-shadow:var(--glow); }

  .container { max-width:1200px; margin:0 auto; padding:0 20px 120px; }
  .stats { margin-bottom:15px; color:var(--muted); font-size:0.85rem; font-weight:bold; text-transform:uppercase; }
  
  .grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(160px, 1fr)); gap:15px; }
  .card { background:var(--card); border:1px solid var(--border); border-radius:18px; padding:22px; cursor:pointer; transition:0.3s; text-align:center; position:relative; }
  .card:hover { background:var(--card-h); transform:translateY(-4px); border-color:rgba(255,255,255,0.2); }
  .card.playing { border-color:var(--accent); background:rgba(232,168,56,0.1); box-shadow:var(--glow); }
  
  .ico { font-size:2.2rem; margin-bottom:10px; display:block; }
  .name { font-weight:700; font-size:0.9rem; line-height:1.3; height:2.6em; overflow:hidden; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; }
  .gtag { font-size:0.65rem; color:var(--muted); font-weight:bold; margin-top:8px; display:block; }

  /* Notification/Player Bar */
  #np-bar { position:fixed; bottom:-100px; left:0; width:100%; background:rgba(15,15,15,0.95); backdrop-filter:blur(12px); border-top:1px solid var(--border); padding:18px 25px; transition:0.5s; z-index:100; display:flex; align-items:center; justify-content:space-between; }
  #np-bar.on { bottom:0; }
  .np-info { display:flex; align-items:center; gap:15px; }
  .np-name { font-weight:700; color:var(--accent); }
  
  /* Loading Spinner */
  .loader { width:18px; height:18px; border:2px solid var(--muted); border-top-color:var(--accent); border-radius:50%; animation:spin 1s linear infinite; display:none; }
  @keyframes spin { to { transform:rotate(360deg); } }

  .btn-stop { background:var(--accent); border:none; color:#000; font-weight:800; padding:8px 20px; border-radius:20px; cursor:pointer; font-size:0.8rem; }
</style>
</head>
<body>

<header>
  <h1>Radio Station Grid</h1>
  <div class="search-container">
    <input type="text" id="search" placeholder="ŒëŒΩŒ±Œ∂ŒÆœÑŒ∑œÉŒ∑..." autocomplete="off">
  </div>
</header>

<div class="container">
  <div id="stats" class="stats">Œ¶œåœÅœÑœâœÉŒ∑...</div>
  <div id="grid" class="grid"></div>
</div>

<div id="np-bar">
  <div class="np-info">
    <div id="loader" class="loader"></div>
    <div>
      <div style="font-size:0.7rem; color:var(--muted)">PLAYING NOW:</div>
      <div id="np-name" class="np-name">-</div>
    </div>
  </div>
  <button class="btn-stop" onclick="stopAll()">STOP</button>
</div>

<audio id="player"></audio>

<script>
let allData = [];
const grid = document.getElementById('grid');
const search = document.getElementById('search');
const stats = document.getElementById('stats');
const player = document.getElementById('player');
const npbar = document.getElementById('np-bar');
const npname = document.getElementById('np-name');
const loader = document.getElementById('loader');
let curCard = null;

async function init() {
  try {
    // Looks for your uploaded JSON file
    const res = await fetch('streams.json');
    allData = await res.json();
    render(allData);
  } catch (e) {
    stats.textContent = "Error: Could not load JSON data.";
  }
}

function render(list) {
  grid.innerHTML = '';
  const online = list.filter(s => s.ok);
  stats.textContent = `${online.length} Stations Available`;

  online.forEach(s => {
    const card = document.createElement('div');
    card.className = 'card';
    const icon = s.tab === 'int' ? 'üåç' : 'üá¨üá∑';
    
    card.innerHTML = `
      <span class="ico">${icon}</span>
      <div class="name">${s.name}</div>
      <span class="gtag">${s.tab === 'int' ? 'INTERNATIONAL' : 'GREEK'}</span>
    `;
    
    card.addEventListener('click', () => playStation(card, s));
    grid.appendChild(card);
  });
}

function stopAll() {
  player.pause();
  player.src = "";
  if (curCard) curCard.classList.remove('playing');
  npbar.classList.remove('on');
  loader.style.display = 'none';
}

async function playStation(card, s) {
  if (card.classList.contains('playing')) {
    stopAll();
    return;
  }

  stopAll();
  curCard = card;
  card.classList.add('playing');
  npname.textContent = s.name;
  npbar.classList.add('on');
  loader.style.display = 'block';

  // --- SAFETY FALLBACK LOGIC ---
  try {
    // 1. Try Primary
    console.log("Trying Primary:", s.stream);
    await attemptStream(s.stream);
  } catch (err1) {
    console.warn("Primary failed. Trying Fallback...");
    
    // 2. Try Fallback if exists
    if (s.fallback && s.fallback !== "-1") {
      try {
        await attemptStream(s.fallback);
      } catch (err2) {
        console.error("Fallback failed. Trying Protocol Switch...");
        attemptProtocolSwitch(s.stream);
      }
    } else {
      // 3. Try Protocol Switch (https -> http)
      attemptProtocolSwitch(s.stream);
    }
  }
}

async function attemptStream(url) {
  player.src = url;
  player.load();
  return player.play().then(() => {
    loader.style.display = 'none';
  });
}

function attemptProtocolSwitch(url) {
  if (url && url.startsWith('https://')) {
    const insecure = url.replace('https://', 'http://');
    attemptStream(insecure).catch(() => handleError());
  } else {
    handleError();
  }
}

function handleError() {
  loader.style.display = 'none';
  npname.textContent = "Stream Offline (Error)";
  if (curCard) curCard.classList.remove('playing');
  setTimeout(stopAll, 4000);
}

search.addEventListener('input', (e) => {
  const q = e.target.value.toLowerCase();
  const filtered = allData.filter(s => s.name.toLowerCase().includes(q));
  render(filtered);
});

init();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greek Radio Retro Deck</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Syne:wght@600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0f0f0f; --panel: #1a1a1a; --accent: #e8a838;
            --display-bg: #0a120a; --display-text: #50ff50; --text: #f0ece3;
        }
        body { font-family: "Syne", sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        /* Dashboard */
        .radio-dashboard { 
            background: var(--panel); width: 100%; max-width: 800px; padding: 25px; 
            border-radius: 12px; border: 4px solid #222; box-shadow: 0 15px 35px rgba(0,0,0,0.7); 
            position: sticky; top: 10px; z-index: 100; margin-bottom: 20px;
        }
        .display-screen { 
            background: var(--display-bg); border: 4px solid #000; padding: 15px; border-radius: 4px; 
            height: 110px; display: flex; flex-direction: column; justify-content: center; 
            align-items: center; text-align: center; font-family: "Orbitron", sans-serif; 
            color: var(--display-text); text-shadow: 0 0 8px rgba(80, 255, 80, 0.6); margin-bottom: 20px;
        }
        .display-cat { font-size: 0.75rem; letter-spacing: 2px; margin-bottom: 8px; color: var(--accent); opacity: 0.9; }
        .display-name { font-size: 1.5rem; font-weight: bold; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; max-width: 90%; }
        
        .main-controls { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
        
        /* Category Buttons */
        .cat-bar { 
            display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; 
            padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px; 
        }
        .cat-btn { 
            background: #2a2a2a; border: 1px solid #444; color: #aaa; padding: 8px 14px; 
            font-size: 0.85rem; cursor: pointer; border-radius: 4px; transition: 0.2s;
        }
        .cat-btn:hover { color: #fff; border-color: var(--accent); }
        .cat-btn.active { background: var(--accent); color: #000; font-weight: bold; border-color: #fff; }

        .btn { 
            background: #333; border: 2px solid #444; color: white; padding: 12px 24px; 
            cursor: pointer; border-radius: 6px; font-weight: bold; font-family: "Orbitron"; 
        }
        .btn:hover { background: #444; color: var(--accent); }
        .btn:active { transform: translateY(2px); background: #222; }

        /* Station Grid */
        #grid-container { 
            width: 100%; max-width: 1000px; display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; margin-top: 20px;
        }
        .card { 
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); 
            padding: 15px; border-radius: 8px; text-align: center; cursor: pointer; transition: 0.2s; 
            font-size: 0.9rem; display: flex; align-items: center; justify-content: center; height: 60px;
        }
        .card:hover { background: rgba(255,255,255,0.08); border-color: var(--accent); }
        .card.active { background: rgba(232, 168, 56, 0.15); border-color: var(--accent); color: var(--accent); font-weight: bold; }
        
        .hint { margin-top: 15px; font-size: 0.7rem; color: #666; font-family: sans-serif; }
    </style>
</head>
<body>

    <div class="radio-dashboard">
        <div class="display-screen">
            <div id="disp-cat" class="display-cat">PLEASE WAIT</div>
            <div id="disp-name" class="display-name">LOADING JSON...</div>
        </div>
        
        <div class="main-controls">
            <button class="btn" onclick="seek(-1)" title="Left Arrow">|<<</button>
            <button class="btn" id="play-pause" onclick="togglePlay()">STOP</button>
            <button class="btn" onclick="seek(1)" title="Right Arrow">>>|</button>
        </div>

        <div id="cat-bar" class="cat-bar"></div>
        <center><div class="hint">USE ARROW KEYS ← → TO SEEK STATIONS</div></center>
    </div>

    <div id="grid-container"></div>
    <audio id="player"></audio>

    <script>
        let allStations = [];
        let filteredStations = [];
        let currentIdx = -1;
        let currentCategory = "";

        const player = document.getElementById("player");
        const dispCat = document.getElementById("disp-cat");
        const dispName = document.getElementById("disp-name");
        const grid = document.getElementById("grid-container");
        const catBar = document.getElementById("cat-bar");

        // 1. Fetch JSON
        fetch("greek_stations.json")
            .then(res => res.json())
            .then(data => {
                allStations = data;
                const categories = [...new Set(data.map(s => s.category))];
                renderCategoryButtons(categories);
                switchCategory(categories[0]); // Load first category by default
            })
            .catch(err => {
                dispName.innerText = "JSON NOT FOUND";
                dispCat.innerText = "ERROR";
            });

        // 2. Render Category Buttons
        function renderCategoryButtons(cats) {
            catBar.innerHTML = "";
            cats.forEach(cat => {
                const btn = document.createElement("button");
                btn.className = "cat-btn";
                btn.innerText = cat;
                btn.id = "cat-btn-" + cat;
                btn.onclick = () => switchCategory(cat);
                catBar.appendChild(btn);
            });
        }

        // 3. Switch Category and Update Grid
        function switchCategory(catName) {
            currentCategory = catName;
            
            // UI Updates
            document.querySelectorAll(".cat-btn").forEach(b => b.classList.remove("active"));
            document.getElementById("cat-btn-" + catName).classList.add("active");

            filteredStations = allStations.filter(s => s.category === catName);
            renderGrid();
            
            dispCat.innerText = catName;
            dispName.innerText = "SELECT STATION";
        }

        function renderGrid() {
            grid.innerHTML = "";
            filteredStations.forEach((s, index) => {
                const card = document.createElement("div");
                card.className = "card";
                card.innerText = s.name;
                card.id = "card-" + index;
                card.onclick = () => playStation(index);
                grid.appendChild(card);
            });
        }

        function playStation(index) {
            if (index < 0 || index >= filteredStations.length) return;
            
            // Remove previous active state
            document.querySelectorAll(".card").forEach(c => c.classList.remove("active"));
            
            currentIdx = index;
            const s = filteredStations[index];
            
            document.getElementById("card-" + index).classList.add("active");
            dispName.innerText = s.name;
            
            player.src = s.streamer;
            player.play().catch(() => dispName.innerText = "STREAM ERROR");
            document.getElementById("play-pause").innerText = "STOP";
        }

        function togglePlay() {
            if (player.paused) { player.play(); document.getElementById("play-pause").innerText = "STOP"; }
            else { player.pause(); document.getElementById("play-pause").innerText = "PLAY"; }
        }

        function seek(dir) {
            let next = currentIdx + dir;
            if (next < 0) next = filteredStations.length - 1;
            if (next >= filteredStations.length) next = 0;
            playStation(next);
        }

        // Keyboard Controls
        window.addEventListener("keydown", (e) => {
            if (e.key === "ArrowLeft") seek(-1);
            if (e.key === "ArrowRight") seek(1);
            if (e.key === " ") { e.preventDefault(); togglePlay(); }
        });
    </script>
</body>
</html>
